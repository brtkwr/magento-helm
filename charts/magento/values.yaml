# Magento Helm Chart Values
# https://github.com/brtkwr/magento-helm

image:
  repository: ghcr.io/brtkwr/magento
  tag: "2.4.8"
  pullPolicy: IfNotPresent

# Magento configuration
magento:
  host: magento.example.com
  language: en_GB
  currency: GBP
  timezone: Europe/London
  # Deploy mode: developer (static content on-the-fly) or production (pre-compiled)
  mode: developer

# Admin users - first user is primary (used for setup:install)
# All users are synced on every pod restart (idempotent)
# Note: Roles must be assigned via admin panel - CLI doesn't support role assignment
adminUsers:
  - username: admin
    email: admin@example.com
    firstname: Admin
    lastname: User
    password: ""  # Set via --set adminUsers[0].password=xxx
# Example:
# adminUsers:
#   - username: brtkwr
#     email: bkunwar@two.inc
#     firstname: Bharat
#     lastname: Kunwar
#     password: mypassword123
#   - username: shabib
#     email: shabib@two.inc
#     firstname: Salman
#     lastname: Habib
#     password: anotherpassword456

# Lifecycle hooks for injecting scripts at different stages
# All hooks should be idempotent (safe to run multiple times)
hooks:
  # Runs before any setup (both upgrade and install paths)
  preSetup: ""
  # Runs after setup:upgrade on existing installs only
  postUpgrade: ""
  # Runs after setup:install on fresh installs only
  postInstall: ""
  # Runs after all setup completes (both paths) - use for config, stores, etc.
  postSetup: ""
  # Example:
  # hooks:
  #   postUpgrade: |
  #     bin/magento admin:user:create --admin-user=admin ... || true
  #   postSetup: |
  #     bin/magento store:create 'Hyva Checkout' hyva || true
  #     bin/magento config:set payment/two_payment/active 1 || true

# DEPRECATED: Use hooks.postSetup instead
postScript: ""

# Database (MariaDB sidecar)
database:
  name: magento
  user: magento
  # password: set via --set or secrets
  image: mariadb
  tag: "10.6"
  storage: 10Gi

# OpenSearch sidecar
opensearch:
  enabled: true
  image: opensearchproject/opensearch
  tag: "2.19.0"
  storage: 5Gi
  javaOpts: "-Xms512m -Xmx512m"

# Persistence
persistence:
  enabled: true
  storageClass: ""
  size: 20Gi

# Ingress
ingress:
  enabled: true
  className: ""
  annotations: {}
  tls:
    enabled: true
    secretName: ""

# Git-sync sidecars for live plugin development
# Each plugin gets its own git-sync container
gitSync:
  image: registry.k8s.io/git-sync/git-sync:v4.2.1
  # Credentials for private repos (optional)
  # Creates a secret with GitHub token for git-sync to use
  credentials:
    # GitHub personal access token (PAT) with repo read access
    # Can be set via --set gitSync.credentials.token=ghp_xxx
    token: ""
  plugins: []
  # Example:
  # plugins:
  #   - name: my-plugin
  #     repo: https://github.com/your-org/magento-plugin.git
  #     branch: main
  #     path: app/code/YourVendor/Module
  #     private: false  # set to true for private repos (uses credentials.token)

# Resources
resources:
  magento:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "2000m"
  database:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "1000m"
  opensearch:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1000m"

# Health checks
healthCheck:
  # Increased to allow init-setup container to complete before main container health check
  initialDelaySeconds: 120
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 30

# Service
service:
  type: ClusterIP
  port: 80

# Pod settings
podAnnotations: {}
nodeSelector: {}
tolerations: []
affinity: {}
